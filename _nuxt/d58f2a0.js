/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{365:function(t,e,n){(function(r){var o,f,h;n(47),n(63),n(64),n(48),n(65),n(45),n(342),n(19),n(46),n(66),n(49),n(67);var l,c=n(366);l=function(t){"use strict";var e=function(){function t(e){var n=void 0===e?{}:e,r=n.version,o=void 0===r?t.CURRENT_NBS_VERSION:r,f=n.default_instruments,h=void 0===f?16:f,l=n.song_length,c=void 0===l?0:l,d=n.song_layers,v=void 0===d?0:d,y=n.song_name,_=void 0===y?"":y,m=n.song_author,w=void 0===m?"":m,x=n.original_author,k=void 0===x?"":x,I=n.description,E=void 0===I?"":I,N=n.tempo,L=void 0===N?10:N,S=n.auto_save,R=void 0!==S&&S,U=n.auto_save_duration,B=void 0===U?10:U,j=n.time_signature,H=void 0===j?4:j,F=n.minutes_spent,O=void 0===F?0:F,P=n.left_clicks,T=void 0===P?0:P,A=n.right_clicks,C=void 0===A?0:A,V=n.blocks_added,J=void 0===V?0:V,M=n.blocks_removed,G=void 0===M?0:M,z=n.song_origin,D=void 0===z?"":z,K=n.loop,Q=void 0!==K&&K,W=n.max_loop_count,X=void 0===W?0:W,Y=n.loop_start,Z=void 0===Y?0:Y;this.version=o,this.default_instruments=h,this.song_length=c,this.song_layers=v,this.song_name=_,this.song_author=w,this.original_author=k,this.description=E,this.tempo=L,this.auto_save=R,this.auto_save_duration=B,this.time_signature=H,this.minutes_spent=O,this.left_clicks=T,this.right_clicks=C,this.blocks_added=J,this.blocks_removed=G,this.song_origin=D,this.loop=Q,this.max_loop_count=X,this.loop_start=Z}return t.CURRENT_NBS_VERSION=4,t}(),n=function(t){var e=t.tick,n=t.layer,r=t.key,o=t.instrument,f=void 0===o?0:o,h=t.velocity,l=void 0===h?100:h,c=t.panning,d=void 0===c?0:c,v=t.pitch,y=void 0===v?0:v;this.tick=e,this.layer=n,this.key=r,this.instrument=f,this.velocity=l,this.panning=d,this.pitch=y},o=function(t){var e=t.id,n=t.name,r=void 0===n?"":n,o=t.lock,f=void 0!==o&&o,h=t.volume,l=void 0===h?100:h,c=t.panning,d=void 0===c?0:c;this.id=e,this.name=r,this.lock=f,this.volume=l,this.panning=d},f=function(t){var e=t.id,n=t.name,r=t.file,o=t.pitch,f=void 0===o?45:o,h=t.press_key,l=void 0!==h&&h;this.id=e,this.name=n,this.file=r,this.pitch=f,this.press_key=l};function h(t,body){var e,n,r,g,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return g={next:f(0),throw:f(1),return:f(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function f(f){return function(h){return function(f){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,n&&(r=2&f[0]?n.return:f[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,f[1])).done)return r;switch(n=0,r&&(f=[2&f[0],r.value]),f[0]){case 0:case 1:r=f;break;case 4:return o.label++,{value:f[1],done:!1};case 5:o.label++,n=f[1],f=[0];continue;case 7:f=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==f[0]&&2!==f[0])){o=0;continue}if(3===f[0]&&(!r||f[1]>r[0]&&f[1]<r[3])){o.label=f[1];break}if(6===f[0]&&o.label<r[1]){o.label=r[1],r=f;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(f);break}r[2]&&o.ops.pop(),o.trys.pop();continue}f=body.call(t,o)}catch(t){f=[6,t],n=0}finally{e=r=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,h])}}}function l(t){var s="function"==typeof Symbol&&Symbol.iterator,e=s&&t[s],i=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}var c=function(){function t(t){this.buffer=t}return t.prototype.encodeFile=function(t,e){this.writeHeader(t,e),this.writeNotes(t,e),this.writeLayers(t,e),this.writeInstruments(t)},t.prototype.writeHeader=function(t,e){var header=t.header;e>0?(this.buffer.uint16(0),this.buffer.uint8(e),this.buffer.uint8(header.default_instruments)):this.buffer.uint16(header.song_length),e>=3&&this.buffer.uint16(header.song_length),this.buffer.uint16(header.song_layers),this.buffer.string(header.song_name),this.buffer.string(header.song_author),this.buffer.string(header.original_author),this.buffer.string(header.description),this.buffer.uint16(Math.round(100*header.tempo)),this.buffer.uint8(Number(header.auto_save)),this.buffer.uint8(header.auto_save_duration),this.buffer.uint8(header.time_signature),this.buffer.uint32(header.minutes_spent),this.buffer.uint32(header.left_clicks),this.buffer.uint32(header.right_clicks),this.buffer.uint32(header.blocks_added),this.buffer.uint32(header.blocks_removed),this.buffer.string(header.song_origin),e>=4&&(this.buffer.uint8(Number(header.loop)),this.buffer.uint8(header.max_loop_count),this.buffer.uint16(header.loop_start))},t.prototype.writeNotes=function(t,e){var n,r,o,f,h=-1;if(t.notes.length>0)try{for(var c=l(t.chords()),d=c.next();!d.done;d=c.next()){var v=d.value,y=v.tick,_=v.notes;this.buffer.uint16(y-h),h=y;var m=-1;try{for(var w=(o=void 0,l(_)),x=w.next();!x.done;x=w.next()){var k=x.value;this.buffer.uint16(k.layer-m),m=k.layer,this.buffer.uint8(k.instrument),this.buffer.uint8(k.key),e>=4&&(this.buffer.uint8(k.velocity),this.buffer.uint8(k.panning+100),this.buffer.int16(k.pitch))}}catch(t){o={error:t}}finally{try{x&&!x.done&&(f=w.return)&&f.call(w)}finally{if(o)throw o.error}}this.buffer.uint16(0)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}this.buffer.uint16(0)},t.prototype.writeLayers=function(t,e){var n,r;try{for(var o=l(t.layers.sort((function(t,e){return t.id-e.id}))),f=o.next();!f.done;f=o.next()){var h=f.value;this.buffer.string(h.name),e>=4&&this.buffer.uint8(h.lock?1:0),this.buffer.uint8(h.volume),e>=2&&this.buffer.uint8(h.panning+100)}}catch(t){n={error:t}}finally{try{f&&!f.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},t.prototype.writeInstruments=function(t){var e,n;this.buffer.uint8(t.instruments.length);try{for(var r=l(t.instruments.sort((function(t,e){return t.id-e.id}))),o=r.next();!o.done;o=r.next()){var f=o.value;this.buffer.string(f.name),this.buffer.string(f.file),this.buffer.uint8(f.pitch),this.buffer.uint8(Number(f.press_key))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t}(),d=function(){function t(t){this.index=0,this.buffer=t}return t.prototype.uint8=function(){var t=this.buffer.readUInt8(this.index);return this.index+=1,t},t.prototype.int8=function(){var t=this.buffer.readInt8(this.index);return this.index+=1,t},t.prototype.uint16=function(){var t=this.buffer.readUInt16LE(this.index);return this.index+=2,t},t.prototype.int16=function(){var t=this.buffer.readInt16LE(this.index);return this.index+=2,t},t.prototype.uint32=function(){var t=this.buffer.readUInt32LE(this.index);return this.index+=4,t},t.prototype.int32=function(){var t=this.buffer.readInt32LE(this.index);return this.index+=4,t},t.prototype.string=function(){var t=this.int32(),e=this.buffer.toString("utf-8",this.index,t+this.index);return this.index+=t,e},t}(),v=function(){function t(t){this.index=0,this.buffer=t}return Object.defineProperty(t.prototype,"data",{get:function(){return this.buffer},enumerable:!1,configurable:!0}),t.prototype.uint8=function(t){this.buffer.writeUInt8(t,this.index),this.index+=1},t.prototype.int8=function(t){this.buffer.writeInt8(t,this.index),this.index+=1},t.prototype.uint16=function(t){this.buffer.writeUInt16LE(t,this.index),this.index+=2},t.prototype.int16=function(t){this.buffer.writeInt16LE(t,this.index),this.index+=2},t.prototype.uint32=function(t){this.buffer.writeUInt32LE(t,this.index),this.index+=4},t.prototype.int32=function(t){this.buffer.writeInt32LE(t,this.index),this.index+=4},t.prototype.string=function(t){this.int32(t.length),this.buffer.write(t,this.index),this.index+=t.length},t}(),y=function(){function t(header,t,e,n){this.header=header,this.notes=t,this.layers=e,this.instruments=n}return t.prototype.writeBuffer=function(t){var n=this;return void 0===t&&(t=e.CURRENT_NBS_VERSION),this.updateHeader(t),new Promise((function(e){var r=new c(new v(n.allocateBuffer()));r.encodeFile(n,t),e(r.buffer.data)}))},t.prototype.chords=function(){var t,e,n,r,o,f,c,d;return h(this,(function(h){switch(h.label){case 0:if(this.notes.length<=0)return[2];t=[],e=this.notes[0].tick,h.label=1;case 1:h.trys.push([1,7,8,9]),n=l(this.notes.sort((function(t,e){return t.tick-e.tick}))),r=n.next(),h.label=2;case 2:return r.done?[3,6]:(o=r.value).tick!==e?[3,3]:(t.push(o),[3,5]);case 3:return t=t.sort((function(t,e){return t.layer-e.layer})),[4,{tick:e,notes:t}];case 4:h.sent(),e=o.tick,t=[o],h.label=5;case 5:return r=n.next(),[3,2];case 6:return[3,9];case 7:return f=h.sent(),c={error:f},[3,9];case 8:try{r&&!r.done&&(d=n.return)&&d.call(n)}finally{if(c)throw c.error}return[7];case 9:return[4,{tick:e,notes:t}];case 10:return h.sent(),[2]}}))},t.prototype.updateHeader=function(t){void 0===t&&(t=-1),t>=0&&(this.header.version=t),this.notes.length>0&&(this.header.song_length=this.notes[this.notes.length-1].tick),this.header.song_layers=this.layers.length},t.prototype.allocateBuffer=function(){var t=this.header.song_name.length+2+(this.header.song_author.length+2)+(this.header.original_author.length+2)+(this.header.description.length+2)+(this.header.song_origin.length+2);t/=8,t+=37;var e=3,n=2;return this.layers.forEach((function(t){e+=(t.name.length+1)/8})),this.instruments.forEach((function(t){n+=(t.name.length+1)/8,n+=(t.file.length+1)/8})),r.alloc(2*(14*this.notes.length+t+e+n))},t}(),_=function(){function t(t){this.buffer=new d(t)}return t.prototype.readFile=function(){var header=this.parseHeader();return new y(header,Array.from(this.parseNotes(header.version)),Array.from(this.parseLayers(header.song_layers,header.version)),Array.from(this.parseInstruments()))},t.prototype.parseHeader=function(){var t=this.buffer.uint16(),n=0;t||(n=this.buffer.uint8());var header=new e;return header.version=n,header.default_instruments=n>0?this.buffer.uint8():10,header.song_length=n>0?this.buffer.uint16():t,header.song_layers=this.buffer.uint16(),header.song_name=this.buffer.string(),header.song_author=this.buffer.string(),header.original_author=this.buffer.string(),header.description=this.buffer.string(),header.tempo=this.buffer.uint16()/100,header.auto_save=1===this.buffer.uint8(),header.auto_save_duration=this.buffer.uint8(),header.time_signature=this.buffer.uint8(),header.minutes_spent=this.buffer.uint32(),header.left_clicks=this.buffer.uint32(),header.right_clicks=this.buffer.uint32(),header.blocks_added=this.buffer.uint32(),header.blocks_removed=this.buffer.uint32(),header.song_origin=this.buffer.string(),header.loop=n>=4&&1===this.buffer.uint8(),header.max_loop_count=n>=4?this.buffer.uint8():0,header.loop_start=n>=4?this.buffer.uint16():0,header},t.prototype.parseNotes=function(t){var e,r,o,f,c,d,v,y,_,m,w,x;return h(this,(function(h){switch(h.label){case 0:h.trys.push([0,11,12,13]),e=l(this.jump()),r=e.next(),h.label=1;case 1:if(r.done)return[3,10];o=r.value,h.label=2;case 2:h.trys.push([2,7,8,9]),w=void 0,f=l(this.jump()),c=f.next(),h.label=3;case 3:return c.done?[3,6]:(d=c.value,[4,new n({tick:o,layer:d,instrument:this.buffer.uint8(),key:this.buffer.uint8(),velocity:t>=4?this.buffer.uint8():100,panning:t>=4?this.buffer.uint8()-100:0,pitch:t>=4?this.buffer.int16():0})]);case 4:h.sent(),h.label=5;case 5:return c=f.next(),[3,3];case 6:return[3,9];case 7:return v=h.sent(),w={error:v},[3,9];case 8:try{c&&!c.done&&(x=f.return)&&x.call(f)}finally{if(w)throw w.error}return[7];case 9:return r=e.next(),[3,1];case 10:return[3,13];case 11:return y=h.sent(),_={error:y},[3,13];case 12:try{r&&!r.done&&(m=e.return)&&m.call(e)}finally{if(_)throw _.error}return[7];case 13:return[2]}}))},t.prototype.parseLayers=function(t,e){var i;return h(this,(function(n){switch(n.label){case 0:i=0,n.label=1;case 1:return i<t?[4,new o({id:i,name:this.buffer.string(),lock:e>=4&&1===this.buffer.uint8(),volume:this.buffer.uint8(),panning:e>=2?this.buffer.uint8()-100:0})]:[3,4];case 2:n.sent(),n.label=3;case 3:return i++,[3,1];case 4:return[2]}}))},t.prototype.parseInstruments=function(){var t,i;return h(this,(function(e){switch(e.label){case 0:t=this.buffer.uint8(),i=0,e.label=1;case 1:return i<t?[4,new f({id:i,name:this.buffer.string(),file:this.buffer.string(),pitch:this.buffer.uint8(),press_key:1===this.buffer.uint8()})]:[3,4];case 2:e.sent(),e.label=3;case 3:return i++,[3,1];case 4:return[2]}}))},t.prototype.jump=function(){var t,e;return h(this,(function(n){switch(n.label){case 0:t=-1,n.label=1;case 1:return(e=this.buffer.uint16())?[4,t+=e]:[3,3];case 2:return n.sent(),[3,1];case 3:return[2]}}))},t}();t.Header=e,t.Instrument=f,t.Layer=o,t.NBSFile=y,t.Note=n,t.Parser=_,t.load=function(t){return new Promise((function(e){e(new _(t).readFile())}))},t.newFile=function(header){var t=new y(header,[],[new o({id:0,name:"",lock:!1,volume:100,panning:0})],[]);return t.header.song_layers=1,t},Object.defineProperty(t,"__esModule",{value:!0})},"object"===c(e)&&void 0!==t?l(e):(f=[e],void 0===(h="function"==typeof(o=l)?o.apply(e,f):o)||(t.exports=h))}).call(this,n(327).Buffer)}}]);